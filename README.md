# Overview

This is an educational project shared with my colleagues. It explains how to start working with Cypress E2E testing in Vite + React projects.

- The codebase uses a sample Todo list to demostrate diverse testing options of Cypress.

# How to install Cypress for E2E testing

- v13.15.0+ by Oct 4, 2024

npm i -D cypress eslint-plugin-cypress

eslint.config.js:

- import pluginCypress from "eslint-plugin-cypress/flat"; // Add this after globals
- ...pluginCypress.configs.recommended.rules, // Add to rules after ...reactHooks.configs.recommended.rules,
  - It resolves the errors like "declare not found" generated by eslint

# Next steps to configure Cypress for E2E and Component testing

- v13.15.0+ by Oct 4, 2024

Whenever you get errors on configuring settings, make sure you have restarted Cypress UI App after applying changes.

1. If you use Vite bundler, add the following lines into vite.config.json to run the app on port 3000 (instead of default 5173)
<pre>
  server: {
    port: 3000,
  },
</pre>

2. Add new file cypress\support\index.d.ts to the root of your project directory. Its content is shown below

   ```typescript
   import { mount } from "cypress/react";

   export {};

   declare global {
     namespace Cypress {
       interface Chainable {
         mount: typeof mount;
         dataCy(value: string): Chainable<JQuery<HTMLElement>>;
       }
     }
   }
   ```

3. Add the following reference in the end of tsconfig.app.json (or directly to tsconfig.json if tsconfig.app.json is not present)
   "include": ["src", "./cypress/support/index.d.ts"]

   - It resolves the annoying problem with "mount not found".

4. Create a sample of your first e2e test, for example, in cypress\e2e\TodoContainer.cy.js

   ```js
   describe("App E2E", () => {
     it("should have a form", () => {
       cy.visit("/");

       cy.get("input").should("have.value", "");
       cy.get("input[type='button']").should("have.value", "Add");
     });
   });
   ```

5. Start DEV project with
   npm run dev

   - Make sure your application loads and works correctly at http://localhost:3000

6. Start Cypress UI app using
   npx cypress open

   - This command should initialize the starting config. Click on E2E Testing > Review > Continue.
   - If you get the error like "ReferenceError: exports is not defined in ES module scope" remove the following line from your package.json
     and restart Cypress UI App:
     - "type": "module",
     - More details: https://medium.com/@chris.castillo.dev/cypress-referenceerror-exports-is-not-defined-in-es-module-scope-w-vite-8264c5b91085

7. Update the file cypress.config.ts and make sure it has the following content: note baseUrl and component > devServer nodes.

   ```typescript
   import { defineConfig } from "cypress";

   export default defineConfig({
     e2e: {
       baseUrl: "http://localhost:3000",
       setupNodeEvents(on, config) {
         // implement node event listeners here
       },
     },

     component: {
       devServer: {
         framework: "react",
         bundler: "vite",
       },
     },
   });
   ```

8. Select E2E Testing > Chrome > Start E2E Testing in Chrome

9. Select your spec and execute tests. They should end up in green (successfully).

10. Close the Cypress app. Now, you should be able to run all tests also in unattanded mode using the command
    npx cypress run

    - You can also run a specific test with a command like
      npx cypress run --spec .\cypress\e2e\TodoContainer.cy.js

11. Add two files to the root of your project directory

- cypress\support\component.js with the following minimal content

  ```js
  import "./commands";

  import { mount } from "cypress/react18";

  Cypress.Commands.add("mount", mount);
  ```

- cypress\support\component-index.html with the following minimal content
  ```html
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width,initial-scale=1.0" />
      <title>Components App</title>
    </head>
    <body>
      <div data-cy-root></div>
    </body>
  </html>
  ```

12. Start the UI app again using
    npx cypress open

13. Select Component Testing > Chrome > Start Component Testing in Chrome

14. Add New spec > Create from component. For instance

    ```typescript
    import React from "react";
    import TodoContainer from "./TodoContainer";

    describe("<TodoContainer />", () => {
      it("renders", () => {
        // see: https://on.cypress.io/mounting-react
        cy.mount(<TodoContainer />);
      });
    });
    ```

    - If you get the error like "Your configFile threw an error from: cypress.config.js" make sure you updated cypress.config.js. Refer to p.7 above

15. Run thes spec and execute tests. They should end up in green (successfully).

# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react/README.md) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type aware lint rules:

- Configure the top-level `parserOptions` property like this:

```js
export default tseslint.config({
  languageOptions: {
    // other options...
    parserOptions: {
      project: ["./tsconfig.node.json", "./tsconfig.app.json"],
      tsconfigRootDir: import.meta.dirname,
    },
  },
});
```

- Replace `tseslint.configs.recommended` to `tseslint.configs.recommendedTypeChecked` or `tseslint.configs.strictTypeChecked`
- Optionally add `...tseslint.configs.stylisticTypeChecked`
- Install [eslint-plugin-react](https://github.com/jsx-eslint/eslint-plugin-react) and update the config:

```js
// eslint.config.js
import react from "eslint-plugin-react";

export default tseslint.config({
  // Set the react version
  settings: { react: { version: "18.3" } },
  plugins: {
    // Add the react plugin
    react,
  },
  rules: {
    // other rules...
    // Enable its recommended rules
    ...react.configs.recommended.rules,
    ...react.configs["jsx-runtime"].rules,
  },
});
```
